<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Newborn HR/RR Practice</title>
  <style>
    body { font-family: system-ui, sans-serif; background: #f7f7fb; color: #111827; margin: 0; }
    .container { max-width: 900px; margin: 0 auto; padding: 24px; }
    header { display: flex; justify-content: space-between; flex-wrap: wrap; align-items: center; margin-bottom: 18px; }
    h1 { font-size: 1.4rem; margin: 0; }
    button { border: 0; padding: 10px 14px; border-radius: 12px; cursor: pointer; }
    button.primary { background: #2563eb; color: #fff; }
    button.primary:hover { background: #1d4ed8; }
    button.secondary { background: #e5e7eb; }
    button.secondary:hover { background: #d1d5db; }
    .status { margin: 10px 0; padding: 8px 10px; border-radius: 8px; font-size: 0.9rem; display: none; background: #fffbeb; border: 1px solid #fef3c7; color: #92400e; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; }
    .card { background: #fff; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb; }
    .input-line { display: flex; align-items: center; gap: 10px; }
    input { width: 120px; padding: 8px 10px; border-radius: 10px; border: 1px solid #d1d5db; font-size: 1rem; }
    .badge { font-size: 0.75rem; padding: 2px 6px; border-radius: 999px; margin-left: 6px; }
    .ok { background: #d1fae5; color: #065f46; }
    .no { background: #fee2e2; color: #991b1b; }
    audio { display: none; }

    /* Confetti canvas overlay */
    #confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="container">
    <header>
      <h1>Newborn HR/RR Practice</h1>
      <div>
        <button id="new-sound" class="primary">New sound</button>
        <button id="play-pause" class="secondary">▶/⏸</button>
      </div>
    </header>

    <div id="status" class="status"></div>
    <audio id="audio" preload="auto"></audio>

    <div class="grid">
      <div class="card">
        <label for="hr">Heart rate (beats/min)</label>
        <div class="input-line">
          <input id="hr">
          <div id="hr-actual"></div>
        </div>
      </div>
      <div class="card">
        <label for="rr">Respiratory rate (breaths/min)</label>
        <div class="input-line">
          <input id="rr">
          <div id="rr-actual"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:16px;">
      <button id="check" class="primary">Check</button>
      <button id="clear" class="secondary">Clear inputs</button>
    </div>
  </div>

<script>
/* ------ App logic ------ */
const FILES = [
  "Breath(38)Heart(126).mp3",
  "Breath(40)Heart(120).mp3",
  "Breath(42)Heart(144).mp3",
  "Breath(46)Heart(130).mp3",
  "Breath(48)Heart(138).mp3",
  "Breath(50)Heart(144).mp3",
  "Breath(52)Heart(146).mp3",
  "Breath(52)Heart(150).mp3",
];

const audioEl = document.getElementById('audio');
const statusBox = document.getElementById('status');
let currentFile = null;
let truth = {hr:null, rr:null};

function parseRates(filename) {
  const m = filename.match(/Breath\((\d+)\)Heart\((\d+)\)\.mp3$/i);
  if (!m) return { rr: null, hr: null };
  return { rr: parseInt(m[1],10), hr: parseInt(m[2],10) };
}

function setStatus(msg) {
  if (!msg) { statusBox.style.display = 'none'; return; }
  statusBox.style.display = 'block'; statusBox.textContent = msg;
}

async function loadAndPlay(file) {
  currentFile = file;
  truth = parseRates(file);
  document.getElementById('hr').value = '';
  document.getElementById('rr').value = '';
  document.getElementById('hr-actual').textContent = '';
  document.getElementById('rr-actual').textContent = '';
  audioEl.loop = true; audioEl.src = file;
  try { await audioEl.play(); setStatus(''); }
  catch { setStatus('Audio ready. Click ▶/⏸ to start.'); }
}

document.getElementById('new-sound').onclick = () => {
  const next = FILES[Math.floor(Math.random()*FILES.length)];
  loadAndPlay(next);
};

document.getElementById('play-pause').onclick = () => {
  if (!audioEl.src) return;
  if (audioEl.paused) audioEl.play(); else audioEl.pause();
};

document.getElementById('check').onclick = () => {
  if (!currentFile) { setStatus('Click “New sound” first.'); return; }
  const hrVal = parseInt(document.getElementById('hr').value,10);
  const rrVal = parseInt(document.getElementById('rr').value,10);

  const hrOK = Number.isFinite(hrVal) && Math.abs(hrVal - truth.hr) <= 10;
  const rrOK = Number.isFinite(rrVal) && Math.abs(rrVal - truth.rr) <= 5;

  const hrExact = Number.isFinite(hrVal) && hrVal === truth.hr;
  const rrExact = Number.isFinite(rrVal) && rrVal === truth.rr;

  document.getElementById('hr-actual').innerHTML =
    `<span>Actual: <strong>${truth.hr}</strong></span>` +
    (hrOK ? '<span class="badge ok">Correct (±10)</span>' :
             '<span class="badge no">Check count</span>');

  document.getElementById('rr-actual').innerHTML =
    `<span>Actual: <strong>${truth.rr}</strong></span>` +
    (rrOK ? '<span class="badge ok">Correct (±5)</span>' :
             '<span class="badge no">Check count</span>');

  if (hrExact) {
    const box = document.getElementById('hr');
    fireConfettiFromElement(box);
  }
  if (rrExact) {
    const box = document.getElementById('rr');
    fireConfettiFromElement(box);
  }
};

document.getElementById('clear').onclick = () => {
  document.getElementById('hr').value = '';
  document.getElementById('rr').value = '';
  document.getElementById('hr-actual').textContent = '';
  document.getElementById('rr-actual').textContent = '';
};

/* ------ Confetti from element, falling down ------ */
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let W = 0, H = 0;
function resizeCanvas() {
  W = canvas.width  = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

function fireConfettiFromElement(el) {
  const rect = el.getBoundingClientRect();
  const originX = rect.left + rect.width/2;
  const originY = rect.top + rect.height; // bottom of the input box

  const particles = [];
  const colors = ['#ef4444','#f59e0b','#10b981','#3b82f6','#a855f7','#ec4899'];
  const N = 80;
  const now = performance.now();
  const duration = 1800;
  const gravity = 0.0015 * H;

  for (let i=0; i<N; i++) {
    const angle = Math.PI/2 + (Math.random()-0.5)*0.6; // mostly downward
    const speed = (0.3 + Math.random() * 0.4) * (H/2);
    particles.push({
      x: originX, y: originY,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed,
      size: 4 + Math.random()*4,
      rot: Math.random()*Math.PI*2,
      vr: (Math.random()-0.5)*0.3,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }

  function tick(t) {
    const dt = (t - (tick.prev || t)) / 1000;
    tick.prev = t;
    ctx.clearRect(0, 0, W, H);

    particles.forEach(p => {
      p.vy += gravity*dt;
      p.x  += p.vx*dt;
      p.y  += p.vy*dt;
      p.rot += p.vr;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      ctx.restore();
    });

    if (t - now < duration) requestAnimationFrame(tick);
    else setTimeout(() => ctx.clearRect(0,0,W,H), 150);
  }
  requestAnimationFrame(tick);
}
</script>
</body>
</html>
